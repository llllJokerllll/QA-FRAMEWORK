# ========================================
# QA-FRAMEWORK - Prometheus Production Config
# ========================================
# Last Updated: 2026-02-23
# Purpose: Production monitoring for SaaS deployment

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: 'qa-framework-prod'
    environment: 'production'

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093
      scheme: http
      timeout: 10s

# Load alert rules
rule_files:
  - '/etc/prometheus/alerts/*.yml'

# Scrape configurations
scrape_configs:
  # ========================================
  # Application Services
  # ========================================
  
  - job_name: 'qa-framework-backend'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['backend:8000']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'qa-framework-backend'

  - job_name: 'qa-framework-worker'
    static_configs:
      - targets: ['worker:8000']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'qa-framework-worker'

  # ========================================
  # Infrastructure Services
  # ========================================
  
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'redis'
    static_configs:
      - targets: ['redis:6379']

  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres:5432']

  # ========================================
  # Custom Metrics (from backend)
  # ========================================
  
  - job_name: 'qa-tests-metrics'
    metrics_path: '/api/v1/metrics/tests'
    static_configs:
      - targets: ['backend:8000']
    scrape_interval: 30s
    scrape_timeout: 10s

  - job_name: 'qa-performance-metrics'
    metrics_path: '/api/v1/metrics/performance'
    static_configs:
      - targets: ['backend:8000']
    scrape_interval: 60s
    scrape_timeout: 15s

# ========================================
# Remote Write (optional - for long-term storage)
# ========================================
# remote_write:
#   - url: "https://your-remote-storage/api/v1/write"
#     basic_auth:
#       username: your_username
#       password: your_password

# ========================================
# Remote Read (optional)
# ========================================
# remote_read:
#   - url: "https://your-remote-storage/api/v1/read"
#     read_recent: true

# ========================================
# Retention Policy
# ========================================
# Note: Set via command line flags:
# --storage.tsdb.retention.time=15d
# --storage.tsdb.retention.size=10GB
